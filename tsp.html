{% extends "layout.html" %}
{% block title %}TSP Example{% endblock %}
{% block heading %}TSP Example{% endblock %}
{% block content %}
<div class="row">
    <div class="col-md-7">
      <a href="#">
        <img class="img-fluid rounded mb-3 mb-md-0" src="{{ url_for('static', filename='images/tsp_map.jpg')}}" alt="">
      </a>
    </div>
    <div class="col-md-5">
      <p>Some short description...</p>
      <a class="btn btn-primary" href="https://www.ise.vt.edu/people/faculty/sarin.html">View More</a>
    </div>
  </div>
  <hr>

<!-- Project -->
<div class="row my-4">
  <div class="col-lg-6 mb-4">
    <div class="card h-100">
      <div class="card-header">Input</div>
      <div class="card-body">
        <form method="POST">
          <div class="form-group">
            <label for="num_cities">Number of cities:</label>
            <input required type="text" class="form-control" id="num_cities" name="num_cities" placeholder="integer, valid range [3,99]" pattern="\b([3-9]|[1-8][0-9]|9[0-9])\b" oninvalid="this.setCustomValidity('integer, valid range [3,99]')" oninput="this.setCustomValidity('')">
          </div>
          <input type="submit" value="Submit" class="btn btn-primary">
          <input type="reset" value="Reset" class="btn btn-danger" onclick="localStorage.removeItem('tsp_result');display_result();">
        </form>
      </div>
    </div>
  </div>
  <div class="col-lg-6 mb-4">
    <div class="card h-100">
      <div class="card-header">Result Summary</div>
      <div class="card-body d-flex flex-column flex-row">
        <table class="table" style="width: 100%">
          <thead>
            <th>num_cities</th>
            <th>obj</th>
            <th>runtime (sec)</th>
          </thead>
          <tbody id="tbody">
          </tbody>
        </table>
        <a id="detail" href='/tsp/detail/' class="btn btn-primary mt-auto mx-auto">Detail</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block myscript %}
  <script>
    {% if result %}
      if(typeof(Storage) !== "undefined") {
        localStorage.setItem('tsp_result', JSON.stringify({{ result|tojson|safe }}));
      } else {
        window.alert("Sorry, your browser does not support local storage...");
      }
    {% endif %}

    function display_result() {
      if(typeof(Storage) !== "undefined") {
        if (localStorage.tsp_result) {
          var res = JSON.parse(localStorage.tsp_result);
          var row = "<tr>"
                  + "<td>" + res.num_cities + "</td>"
                  + "<td>" + res.obj.toFixed(2) + "</td>"
                  + "<td>" + res.runtime.toFixed(3) + "</td>"
                  + "</tr>";
          document.getElementById("tbody").innerHTML = row;
        } else {
          document.getElementById("tbody").innerHTML = '';
        }
      } else {
        window.alert("Sorry, your browser does not support local storage...");
      }
    }
    display_result()
  </script> 
{% endblock %}
    

